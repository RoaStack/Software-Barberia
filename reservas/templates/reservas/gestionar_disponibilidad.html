{% extends "base_barbero.html" %}
{% block barbero_content %}
<div class="container mt-4">
  <h3 class="fw-bold text-center mb-4">Gestionar Disponibilidades</h3>

  <form method="POST" class="card p-3 shadow-sm mb-4">
    {% csrf_token %}
    <div class="row">
      <div class="col-md-5">
        <label for="id_fecha" class="form-label">Fecha:</label>
        <input type="date" name="fecha" id="id_fecha" class="form-control" required>
      </div>
      <div class="col-md-5">
        <p class="mb-2">{{ form.horas.label }}</p>
        {{ form.horas }}
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <button type="submit" class="btn btn-primary w-100">Agregar</button>
      </div>
    </div>
  </form>

  <!-- üîπ Navegaci√≥n por d√≠as -->
<div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-3 gap-2">

  <div class="d-flex align-items-center gap-2">
    <button class="btn btn-outline-secondary" id="prevDay">‚Üê D√≠a anterior</button>
    <button class="btn btn-outline-secondary" id="nextDay">D√≠a siguiente ‚Üí</button>
  </div>

  <!-- üîπ Selector de fecha para filtrar -->
  <div class="d-flex align-items-center gap-2">
    <label for="filterFecha" class="fw-semibold mb-0">Filtrar por fecha:</label>
    <input type="date" id="filterFecha" class="form-control" value="{{ fecha_seleccionada|date:'Y-m-d' }}">
  </div>
</div>


  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="fw-bold mb-3">Tus horarios</h5>
      {% if disponibilidades %}
        <table class="table table-striped text-center align-middle">
          <thead class="table-dark">
            <tr>
              <th>Fecha</th>
              <th>Hora</th>
              <th>Estado</th>
              <th>Acci√≥n</th>
            </tr>
          </thead>
          <tbody>
            {% for d in disponibilidades %}
              <tr>
                <td>{{ d.fecha|date:"j \\d\\e F \\d\\e Y" }}</td>
                <td>{{ d.hora }}</td>
                <td>
                  {% if d.disponible %}
                    <span class="badge bg-success">Disponible</span>
                  {% else %}
                    <span class="badge bg-secondary">Ocupado</span>
                  {% endif %}
                </td>
                <td>
                  {% if d.disponible %}
                  <a href="{% url 'reservas:eliminar_disponibilidad' d.id %}" class="btn btn-sm btn-danger">Eliminar</a>
                  {% else %}
                  <a href="#" class="btn btn-sm btn-primary disabled" tabindex="-1" aria-disabled="true">Ocupado</a>
                  {% endif %}
                  </td>

              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="text-muted text-center">No tienes horarios para este d√≠a.</p>
      {% endif %}
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const currentDate = new Date("{{ fecha_seleccionada|date:'Y-m-d' }}");

    document.getElementById('prevDay').addEventListener('click', function() {
      const prev = new Date(currentDate);
      prev.setDate(prev.getDate() - 1);
      window.location.href = `?fecha=${prev.toISOString().split('T')[0]}`;
    });

    document.getElementById('nextDay').addEventListener('click', function() {
      const next = new Date(currentDate);
      next.setDate(next.getDate() + 1);
      window.location.href = `?fecha=${next.toISOString().split('T')[0]}`;
    });

    // Mantener fecha m√≠nima para el input
    const fechaInput = document.getElementById('id_fecha');
    const today = new Date().toISOString().split('T')[0];
    fechaInput.min = today;
  });
  document.addEventListener('DOMContentLoaded', function() {
    const currentDate = new Date("{{ fecha_seleccionada|date:'Y-m-d' }}");

    document.getElementById('prevDay').addEventListener('click', function() {
      const prev = new Date(currentDate);
      prev.setDate(prev.getDate() - 1);
      window.location.href = `?fecha=${prev.toISOString().split('T')[0]}`;
    });

    document.getElementById('nextDay').addEventListener('click', function() {
      const next = new Date(currentDate);
      next.setDate(next.getDate() + 1);
      window.location.href = `?fecha=${next.toISOString().split('T')[0]}`;
    });

    // üîπ Filtro manual de fecha
    const filterInput = document.getElementById('filterFecha');
    filterInput.addEventListener('change', function() {
      const selected = this.value;
      if (selected) {
        window.location.href = `?fecha=${selected}`;
      }
    });

    // üîπ Fecha m√≠nima para evitar seleccionar d√≠as pasados
    const today = new Date().toISOString().split('T')[0];
    filterInput.min = today;
  });
</script>

{% endblock %}
